<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>title</title>
        <meta name="description" content="|title|">
        <meta name="author" content="Roger Ragulan Rajaratnam (roger@ragusource.com)">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
        <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
        <script src="https://js.stripe.com/v2/"></script>
        <style>
            body {
                padding-top: 100px;
            }
            .container-fluid {
                max-width: 960px;
            }
        </style>
    </head>
    <body>

        <div class="container-fluid">

            <div class="row">

                <div class="col-md-12">

                    <div class="jumbotron">
                        <h1>EAK - Payment Demo</h1>
                    </div>

                    <div class="alert alert-danger payment-errors hide" role="alert">
                    </div>

                    <form action="/charge" method="post" id="payment-form">

                        <div class="form-group">
                            <label>Card Number</label>
                            <input type="text" class="form-control" data-stripe="number" placeholder="4242 4242 4242 4242">
                        </div>

                        <div class="form-group">
                            <label>Expiration (MM/YY)</label>
                            <div class="input-group">
                                <input type="text" class="form-control" data-stripe="exp_month" placeholder="09">
                                <div class="input-group-addon">/</div>
                                <input type="text" class="form-control" data-stripe="exp_year" placeholder="19">
                            </div>
                        </div>

                        <div class="form-group">
                            <label>CVC</label>
                            <input type="text" class="form-control" data-stripe="cvc" placeholder="123">
                        </div>

                        <div class="checkbox">
                            <label>Postcode</label>
                            <input type="text" class="form-control" data-stripe="address_zip" placeholder="12345">
                        </div>

                        <button type="submit" class="btn btn-default">Submit</button>

                    </form>

                </div>

            </div>

        </div>

        <script type="text/javascript">

            function stripeResponseHandler(status, response) {
                // Grab the form:
                var $form = $('#payment-form');

                if (response.error) { // Problem!

                    // Show the errors on the form:
                    $('.payment-errors').html(response.error.message).removeClass('hide');
                    $form.find('.submit').prop('disabled', false); // Re-enable submission

                } else { // Token was created!

                    // Get the token ID:
                    var token = response.id;

                    // Insert the token ID into the form so it gets submitted to the server:
                    $form.append($('<input type="hidden" name="stripeToken">').val(token));

                    // Submit the form:
                    $form.get(0).submit();
                }
            };

            Stripe.setPublishableKey('pk_test_cA7dgir7RDXeSfI1ehdPDRxy');

            $(function() {
                var $form = $('#payment-form');
                $form.submit(function(event) {
                    // Disable the submit button to prevent repeated clicks:
                    $form.find('.submit').prop('disabled', true);

                    // Request a token from Stripe:
                    Stripe.card.createToken($form, stripeResponseHandler);

                    // Prevent the form from being submitted:
                    return false;
                });
            });

        </script>
    </body>
</html>
